name: Deploy

# âœ… ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´ ì„¤ì •
on:
  push:
    branches: [dev] # í¬í¬ëœ ë ˆí¬ì˜ dev ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œë§Œ ì‹¤í–‰

jobs:
  build:
    runs-on: ubuntu-latest

    # ğŸ“¦ Pandoc + LaTeX ì»¨í…Œì´ë„ˆ í™˜ê²½ ì‚¬ìš© (PDF ë¹Œë“œ ë“± LaTeX í•„ìš”í•œ ê²½ìš°)
    container: pandoc/latex

    steps:
      # 1ï¸âƒ£ í˜„ì¬ ë ˆí¬ì§€í† ë¦¬ë¥¼ ì²´í¬ì•„ì›ƒ
      - uses: actions/checkout@v2

      # 2ï¸âƒ£ mustache í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ruby ë° mustache ì„¤ì¹˜
      - name: Install mustache (to update the date)
        run: apk add ruby && gem install mustache

      # 3ï¸âƒ£ ì›¹ì‚¬ì´íŠ¸ ë“± ìµœì¢… ì¶œë ¥ë¬¼ ìƒì„± (ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‚¬ìš©ì ì •ì˜)
      - name: creates output
        run: sh ./src/web/build.sh

      # 4ï¸âƒ£ ê²°ê³¼ë¬¼ì„ ë‹¤ë¥¸ GitHub ë ˆí¬(ì˜ˆ: ë°°í¬ìš©)ë¡œ push
      - name: Pushes to another repository
        id: push_directory
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.AUTO_ACTIONS }} # ëŒ€ìƒ ë ˆí¬ì— push ê¶Œí•œ ìˆëŠ” PAT
        with:
          source-directory: "output" # ê²°ê³¼ë¬¼ ë””ë ‰í† ë¦¬
          destination-github-username: anhyeryeon2 # ëŒ€ìƒ ì‚¬ìš©ìëª… (ìì‹ ì˜ ê¹ƒí—™ ID)
          destination-repository-name: MOVIEBOOKIE_FE # ëŒ€ìƒ ë ˆí¬ ì´ë¦„
          user-email: ${{ secrets.EMAIL }} # ì»¤ë°‹í•  ì´ë©”ì¼ (ì„¤ì • í•„ìš”)
          commit-message: ${{ github.event.commits[0].message }} # ì»¤ë°‹ ë©”ì‹œì§€ ì¬ì‚¬ìš©
          target-branch: dev # ëŒ€ìƒ ë ˆí¬ì˜ ë¸Œëœì¹˜

      # 5ï¸âƒ£ push-to-another-repository ì•¡ì…˜ì—ì„œ ì„¤ì •í•œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸ìš©
      - name: Test get variable exported by push-to-another-repository
        run: echo $DESTINATION_CLONED_DIRECTORY
